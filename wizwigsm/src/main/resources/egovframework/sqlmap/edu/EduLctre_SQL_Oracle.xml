<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE sqlMap PUBLIC "-//iBATIS.com//DTD SQL Map 2.0//EN" "http://www.ibatis.com/dtd/sql-map-2.dtd">

<sqlMap namespace="LctreDAO">
	
	<typeAlias  alias="egovMap"  type="egovframework.rte.psl.dataaccess.util.EgovMap"/>
	<typeAlias  alias="LctreVO" 	type="egovframework.lctre.service.LctreVO"/>		
	<typeAlias  alias="InstrctrVO" type="egovframework.lctre.service.InstrctrVO"/>
	
	<!-- 화면01_강의목록  -->
	<select id="LctreDAO.selectLctreList" parameterClass="LctreVO" resultClass="LctreVO">				
		<![CDATA[
			SELECT LCT.LCTRE_SEQ
                    , LCT.LCTRE_NM
                    , INS.INSTRCTR_NM
                    , LCT.RCRUNDT
                    , TO_CHAR(LCT.FRST_REGIST_PNTTM, 'YYYY.MM.DD') AS FRST_REGIST_PNTTM
                    , LCT.RDCNT
                    , (SELECT COUNT(REQ.REQST_SEQ)
								FROM T_REQST REQ
								WHERE 1=1
								AND REQ.LCTRE_SEQ = LCT.LCTRE_SEQ) AS REQST_CNT
            FROM T_LCTRE LCT, T_INSTRCTR INS
            WHERE 1=1 
            AND LCT.INSTRCTR_SEQ = INS.INSTRCTR_SEQ
            AND LCT.USE_AT = 'Y'            
            ORDER BY LCT.LCTRE_SEQ DESC 
		]]> 	
	</select> 	
	
	<!-- 화면01_강의목록_모집 -->
	<!-- 현재 신청자수를 신청테이블의  해당 강의번호에 해당하는 신청번호들을(REQST_SEQ) COUNT해서 (REQST_SEQ별칭으로 담는다.)-->
	<!-- parameterClass로 강의번호(lctre_seq) 넘겨받음.  -->
	<!-- resultClass로 카운트한 신청자수 반환./ 이 값은 목록에서 받게된다. -->
<!-- 	<select id="LctreDAO.selectReqstCnt" parameterClass="LctreVO" resultClass="LctreVO">
		<![CDATA[			
			SELECT COUNT(REQ.REQST_SEQ) AS REQST_CNT
			FROM T_REQST REQ, T_LCTRE LCT
			WHERE 1=1
			AND REQ.LCTRE_SEQ = LCT.LCTRE_SEQ
		]]>
	</select> -->
	
	<!-- 강의등록폼_등록한 강사 comboBox로 불러오기 -->
	<select id="LctreDAO.selectInstrctrNmCobList" parameterClass="LctreVO" resultClass="InstrctrVO">
		<![CDATA[
			SELECT INSTRCTR_SEQ 
				 , INSTRCTR_NM						
			FROM T_INSTRCTR
			WHERE 1=1
			AND USE_AT = 'Y'
			ORDER BY INSTRCTR_SEQ DESC
		]]>
	</select>
	
	<!-- 화면02_강의등록폼 -->
	<insert id="LctreDAO.insertLctreForm" parameterClass="LctreVO">
		<![CDATA[
			INSERT INTO T_LCTRE
				(LCTRE_SEQ	
				, LCTRE_NM
				, INSTRCTR_SEQ
				, RCRUNDT
				, FRST_REGIST_PNTTM
				, LAST_UPDT_PNTTM
				, USE_AT
				, RDCNT)
			VALUES
				(SEQ_LCTRE.NEXTVAL				
				, #lctre_nm#
				, #instrctr_seq#
				, #rcrundt#
				, SYSDATE
				, SYSDATE
				,'Y'
				, 0)
		]]>
	</insert>
	
	<!-- 조회수 select --> 
	<!-- <select id="LctreDAO.selectLctreRdcnt" parameterClass="LctreVO" resultClass="LctreVO">
		<![CDATA[
			SELECT NVL(MAX(RDCNT),0)+1 AS rdcnt
			FROM T_LCTRE
			WHERE 1=1
			AND LCTRE_SEQ=#lctre_seq#
		]]>
	</select> -->
	
	<!-- 조회수 -->
	<update id="LctreDAO.updateLctreRdcnt" parameterClass="LctreVO">
		<![CDATA[
			UPDATE T_LCTRE
			SET 
			RDCNT = (SELECT NVL(MAX(RDCNT),0)+1 AS rdcnt
					FROM T_LCTRE
					WHERE 1=1
					AND LCTRE_SEQ=#lctre_seq#)
			WHERE 1=1
			AND LCTRE_SEQ = #lctre_seq# 
		]]>
	</update>
	
	<!-- 화면03_강의상세보기 -->
	<select id="LctreDAO.selectLctreDetail" parameterClass="LctreVO" resultClass="LctreVO">
		<![CDATA[
			SELECT LCT.LCTRE_SEQ
                    , LCT.LCTRE_NM
                    , INS.INSTRCTR_SEQ  
                    , INS.INSTRCTR_NM
                    , LCT.RCRUNDT
                    , LCT.RDCNT
            FROM T_LCTRE LCT, T_INSTRCTR INS
            WHERE 1=1
            AND LCT.INSTRCTR_SEQ = INS.INSTRCTR_SEQ          
            AND LCT.LCTRE_SEQ = #lctre_seq#
		]]>
	</select>	
	
	<!-- 화면04_강의수정 -->
	<update id="LctreDAO.updateLctre" parameterClass="LctreVO">
		<![CDATA[
			UPDATE T_LCTRE
			SET INSTRCTR_SEQ = #instrctr_seq# 
			, LCTRE_NM = #lctre_nm#
			, RCRUNDT = #rcrundt#
			, LAST_UPDT_PNTTM = SYSDATE
			WHERE 1=1
			AND LCTRE_SEQ = #lctre_seq#
		]]>
	</update>
	
	<!-- 화면04_강의삭제 -->
	<!-- 단, 실제로 DELETE를 수행하지 않고 'USE_AT'값을 'N'로 변경해 강의목록에 나오지 않게 한다.  -->
	<update id="LctreDAO.deleteLctre" parameterClass="LctreVO">
		<![CDATA[
			UPDATE T_LCTRE
			SET USE_AT = 'N'
			WHERE 1=1
			AND LCTRE_SEQ = #lctre_seq#
		]]>
	</update>
</sqlMap>	
